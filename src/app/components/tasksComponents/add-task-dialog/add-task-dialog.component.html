<div class="dialog-wrapper">
  <div class="dialog-header-custom">
    <h2 mat-dialog-title>Add New Task</h2>
    <button mat-icon-button class="close-btn" (click)="onCancel()" matTooltip="Close">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content class="dialog-container">
    <form [formGroup]="taskForm">

      @if (!data?.projectId) {
      <mat-form-field class="full-width" appearance="outline">
        <mat-label>Project</mat-label>
        <mat-select formControlName="projectId" cdkFocusInitial>
          @for (project of projectsService.allProjects(); track project.id) {
          <mat-option [value]="project.id">{{ project.name }}</mat-option>
          }
        </mat-select>
        @if (taskForm.get('projectId')?.hasError('required') && taskForm.get('projectId')?.touched) {
        <mat-error>Please select a project</mat-error>
        }
      </mat-form-field>
      }

      <mat-form-field class="full-width" appearance="outline">
        <mat-label>Task Title</mat-label>
        <input 
          matInput 
          formControlName="title" 
          placeholder="What needs to be done?">
        @if (taskForm.get('title')?.hasError('required') && taskForm.get('title')?.touched) {
        <mat-error>Title is required</mat-error>
        }
      </mat-form-field>

      <mat-form-field class="full-width" appearance="outline">
        <mat-label>Description</mat-label>
        <textarea 
          matInput 
          formControlName="description" 
          rows="3"
          placeholder="Add task description"></textarea>
      </mat-form-field>

      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Priority</mat-label>
          <mat-select formControlName="priority">
            <mat-option value="low">Low</mat-option>
            <mat-option value="normal">Normal</mat-option>
            <mat-option value="high">High</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Due Date</mat-label>
          <input 
            matInput 
            [matDatepicker]="picker" 
            formControlName="dueDate"
            placeholder="Select a date">
          <mat-hint>MM/DD/YYYY</mat-hint>
          <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions class="actions">
    <button mat-button (click)="onCancel()" matTooltip="Cancel">Cancel</button>
    <button 
      mat-flat-button 
      color="primary" 
      [disabled]="taskForm.invalid" 
      (click)="onSubmit()"
      matTooltip="Create New Task">
      Create Task
    </button>
  </mat-dialog-actions>
</div>